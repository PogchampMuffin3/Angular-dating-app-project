<div class="container-fluid d-flex flex-column p-0" style="height: calc(100vh - 60px);">
  <div class="row flex-grow-1 m-0 overflow-hidden">

    <!-- LEWA STRONA: Lista uÅ¼ytkownikÃ³w -->
    <div class="col-12 col-md-4 col-lg-3 border-end p-0 d-flex flex-column bg-white"
         [class.d-none]="selectedUser" [class.d-md-flex]="true">

      <div class="p-3 border-bottom bg-light d-flex justify-content-between align-items-center">
        <h5 class="mb-0 fw-bold">WiadomoÅ›ci</h5>
      </div>

      <div class="overflow-auto flex-grow-1">
        <!-- PÄ™tla po uÅ¼ytkownikach z serwera -->
        <div *ngFor="let user of users"
             (click)="selectUser(user)"
             class="p-3 border-bottom d-flex align-items-center cursor-pointer hover-bg-light"
             [class.bg-light]="selectedUser?.id === user.id">

          <!-- Avatar -->
          <div [class]="user.avatarColor || 'bg-secondary'"
               class="rounded-circle text-white d-flex align-items-center justify-content-center me-3"
               style="width: 50px; height: 50px; font-size: 1.2rem;">
            {{ user.name.charAt(0) }}
          </div>

          <div>
            <div class="fw-bold">{{ user.name }}</div>
            <small class="text-muted">Kliknij, aby napisaÄ‡</small>
          </div>
        </div>
      </div>
    </div>

    <!-- PRAWA STRONA: Czat -->
    <div class="col-12 col-md-8 col-lg-9 p-0 d-flex flex-column bg-light"
         [class.d-none]="!selectedUser" [class.d-flex]="true">

      <!-- NagÅ‚Ã³wek czatu -->
      <div *ngIf="selectedUser" class="p-3 border-bottom bg-white d-flex align-items-center shadow-sm">
        <button (click)="backToList()" class="btn btn-link text-dark d-md-none me-2">
          <i class="bi bi-arrow-left fs-4"></i>
        </button>
        <div [class]="selectedUser.avatarColor || 'bg-secondary'"
             class="rounded-circle text-white d-flex align-items-center justify-content-center me-3"
             style="width: 40px; height: 40px;">
          {{ selectedUser.name.charAt(0) }}
        </div>
        <h6 class="mb-0 fw-bold">{{ selectedUser.name }}</h6>
      </div>

      <!-- Obszar wiadomoÅ›ci -->
      <div *ngIf="selectedUser" class="flex-grow-1 p-3 overflow-auto d-flex flex-column" style="background: #f0f2f5;">

        <!-- PÄ™tla po wiadomoÅ›ciach -->
        <div *ngFor="let msg of messages"
             class="d-flex mb-3"
             [ngClass]="{'justify-content-end': msg.fromId === myId, 'justify-content-start': msg.fromId !== myId}">

          <div class="p-3 rounded-4 shadow-sm"
               [ngClass]="{
                 'bg-primary text-white rounded-br-0': msg.fromId === myId,
                 'bg-white text-dark rounded-bl-0': msg.fromId !== myId
               }"
               style="max-width: 75%;">
            <div>{{ msg.content }}</div>
            <div class="text-end mt-1" style="font-size: 0.7rem; opacity: 0.8;">
              {{ msg.time }}
            </div>
          </div>
        </div>

        <div *ngIf="messages.length === 0" class="text-center text-muted mt-5">
          Rozpocznij nowÄ… rozmowÄ™ ðŸ‘‹
        </div>

      </div>

      <!-- Brak wybranego uÅ¼ytkownika (desktop) -->
      <div *ngIf="!selectedUser" class="flex-grow-1 d-flex align-items-center justify-content-center text-muted">
        <div class="text-center">
          <i class="bi bi-chat-dots display-1"></i>
          <p class="mt-3">Wybierz osobÄ™, aby rozpoczÄ…Ä‡ czat</p>
        </div>
      </div>

      <!-- Input do pisania -->
      <div *ngIf="selectedUser" class="p-3 bg-white border-top">
        <div class="input-group">
          <input [(ngModel)]="newMessageText"
                 (keyup.enter)="sendMessage()"
                 type="text"
                 class="form-control rounded-pill bg-light border-0 py-2 px-3"
                 placeholder="Napisz wiadomoÅ›Ä‡...">
          <button (click)="sendMessage()" class="btn btn-primary rounded-circle ms-2" style="width: 45px; height: 45px;">
            <i class="bi bi-send-fill"></i>
          </button>
        </div>
      </div>

    </div>
  </div>
</div>
